<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>发布找人</title>
    @import "../../include/header.inc";

</head>
<body ontouchstart>
<div class="weui-toptips weui-toptips_warn js_tooltips">错误提示</div>
<div class="container" id="container"></div>

<!--首页-->
<link rel="import" href="../../../../pages/carpool/find/people.html">

<link rel="import" href="../../../../model/templete/carpool/carMode.html">
<link rel="import" href="../../../../model/templete/carpool/carBrand.html">

@import "../../../../model/widget/include/toast.html";
@import "../../../../model/widget/include/dialog.html";
<script src="/weixin/js/wap.min.js"></script>
<script type="text/javascript">
    $(function () {
        pageManager.show("people");

        function p(s) {
            return s < 10 ? '0' + s : s;
        }

        var myDate = new Date();
        var year = myDate.getFullYear();
        var month = myDate.getMonth() + 1;
        var date = myDate.getDate();
        var h = myDate.getHours();       //获取当前小时数(0-23)
        var m = myDate.getMinutes();     //获取当前分钟数(0-59)
        var s = myDate.getSeconds();
        var now = year + '-' + p(month) + "-" + p(date);
        var time = p(h) + ':' + p(m) + ":" + p(s);
        $('.showDatePicker').html(now);
        $('.showTimePicker').html(time);
        $(document).on('click', '#showDatePicker', function () {
            weui.datePicker({
                start: new Date(),
                end: new Date().getFullYear() + 1,
                defaultValue: [year,month,date],
                onChange: function (result) {
                    console.log(result);
                },
                onConfirm: function (result) {
                    var year = result[0].value;
                    var month = result[1].value;
                    var date = result[2].value;
                    $('.showDatePicker').html(year + '-' + month + '-' + date);
                }
            });
        });
        $(document).on('click','#showTimePicker',function () {
            var hours = [],
                minites = [],
                symbol = [{label: ':', value: 0}];

            // var date = date[0].label + date[1].label + date[2].label;
            if (!hours.length) {
                for (var i = 0; i < 24; i++) {
                    var hours_item = {};
                    hours_item.label = ('' + i).length === 1 ? '0' + i : '' + i;
                    hours_item.value = i;
                    hours.push(hours_item);
                }
            }
            if (!minites.length) {
                minites = [
                    {label: '00', value: '00'},
                    {label: '30', value: '30'}
                ];

            }
            weui.picker(hours, symbol, minites, {
                defaultValue: [new Date().getHours() + 1, 0, 0],
                onConfirm: function (result) {
                    var time = result[0].label + ':' + result[2].label;
                    var expect_date = date + ' ' + time;
                    $('.showTimePicker').html(time);
                },
                id: 'ma_expect_time'
            });
        });
        $('#showPeoplePicker').on('click', function () {
            weui.picker([{
                label: '1',
                value: 1
            }, {
                label: '2',
                value: 2
            }, {
                label: '3',
                value: 3
            }, {
                label: '4',
                value: 4
            }], {
                onChange: function (result) {
                    console.log(result);
                },
                onConfirm: function (result) {
                    $('.showPeoplePicker').val(result);
                }
            });
        });


        var carsMode = new cars(function (data) {
            var mode = render.fill($("#tpl_carMode"), data);
            $(".cars").html(mode);
        });
        carsMode.mode();
        var id = $('.cars li').first().attr('data-id');


        $('#showCar').click(function () {
            $("#carMode").actionsheet();
            $('.mask').css({'display': 'block'});
        });

        $('#brandBtn').click(function () {

            if ($('.carModeTxt').val() == '') {
                toast.show('请先填写车系')
            } else {
                $("#brand").actionsheet();
            }
        });

        $(document).on('click', '#carMode ul li', function () {
            var id = $(this).attr('data-id');
            $('.carModeTxt').val($(this).html());
            $('.carModeTxt').attr('data-id', id);
            new cars(function (data) {
                var mode = render.fill($("#tpl_carBrand"), data.productList);
                $(".carBrand").html(mode);
            }).brand({carId: id});
            $("#carMode").actionsheetClose();
        });

        // $('.brand ul li').click(function () {
        $(document).on('click', '#brand ul li', function () {
            var id = $(this).attr('data-id');
            $('.carBrandtxt').val($(this).html());
            $('.carBrandtxt').attr('data-id', id);
            $("#brand").actionsheetClose();
        });

        //实时判断手机号
        var mobilevalid = /^(0|86|17951)?(13[0-9]|15[012356789]|17[0678]|18[0-9]|14[57])[0-9]{8}$/;
        var bind_name = 'input';
        if (navigator.userAgent.indexOf("MSIE") != -1) {
            bind_name = 'propertychange';
        }
        if (navigator.userAgent.match(/android/i) == "android") {
            bind_name = "keydown";
        }
        $("#phone").bind(bind_name, function (event) {
            var number = $('#phone').val();
            if (number.length == 11) {
                if (!mobilevalid.test(number)) {
                    dialog.show("请输入正确的手机号码！");
                    return false;
                }
            } else if (number.length > 11) {
                $('#phone').val('');
                dialog.show("请输入11位手机号码！");
                return false;
            }
        });


        $('.publish_btn').click(function(){
            var name = $('#name').val();
            var phone = $('#phone').val();
            var start = $('#start').val();
            var end = $('#end').val();
            var startdate = $('.showDatePicker').html();
            var starttime = $('.showTimePicker').html();
            var seat = $('.showPeoplePicker').val();
            var series = $('#showCar').val();
            var brand = $('#brandBtn').val();
            var remarks = $('#remarks').val();
            if($('#weuiAgree').is(':checked')){
                new cars(function(data){
                    toast.show('发布成功');
                    setTimeout(function(){
                        history.back(-1);
                    },2000)
                }).pullpool({
                    type:1,
                    name:name,
                    phonenum:phone,
                    start:start,
                    end:end,
                    startdate:startdate,
                    starttime:starttime,
                    seat:seat,
                    brand:brand,
                    series:series,
                    remarks:remarks
                })
            }else{
                toast.show('请先阅读并同意《免责声明》')
            }
        });

    });
</script>

</body>
</html>