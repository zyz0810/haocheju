<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>立即预约</title>
    @import "../include/header.inc";

</head>
<body ontouchstart>
<div class="weui-toptips weui-toptips_warn js_tooltips">错误提示</div>
<div class="container" id="container"></div>

<!--首页-->
<link rel="import" href="../../../pages/appointment/index.html">

@import "../../../model/widget/include/toast.html";
@import "../../../model/widget/include/dialog.html";
<script src="/weixin/js/wap.min.js"></script>
<script type="text/javascript">
    $(function () {
        pageManager.show("index");
        var userId = cookie.getCookie('userId');
        if(pageManager.GetQueryString("type") == 'new'){
            new cars(function (data) {
                $('.car_img').html(data.carcontent);
            }).newView({id:pageManager.GetQueryString("id")});
            $('.publish_btn').click(function () {
                var name = $('#name').val();
                var phone = $('#phone').val();
                new cars(function (data) {
                    toast.show('预约成功');
                }).subscribe({username:name,phonenum:phone,type:'1',productId:pageManager.GetQueryString("id")})
            })
        }else{
            new cars(function (data) {
                $('.collect').attr('data-cid',data.cid);
            }).usedView({id:pageManager.GetQueryString("id"),userId:userId});

            var name = $('#name').val();
            var phone = $('#phone').val();
            new cars(function (data) {
                toast.show('预约成功');
            }).subscribe({username:name,phonenum:phone,type:'2',productId:pageManager.GetQueryString("id")})
        }

        //实时判断手机号
        var mobilevalid = /^(0|86|17951)?(13[0-9]|15[012356789]|17[0678]|18[0-9]|14[57])[0-9]{8}$/;
        var bind_name = 'input';
        if (navigator.userAgent.indexOf("MSIE") != -1) {
            bind_name = 'propertychange';
        }
        if (navigator.userAgent.match(/android/i) == "android") {
            bind_name = "keydown";
        }
        $("#phone").bind(bind_name, function (event) {
            var number = $('#phone').val();
            if (number.length == 11) {
                if (!mobilevalid.test(number)) {
                    dialog.show("请输入正确的手机号码！");
                    return false;
                }else{
                    if($('#phone').val().length == 11 && $('#name').val().length > 0){
                        $('.publish_btn').css({'background':'#0f84de'});
                    }else{
                        $('.publish_btn').css({'background':'#ccc'});
                    }
                }
            } else if (number.length > 11) {
                $('#phone').val('');
                dialog.show("请输入11位手机号码！");
                return false;
            }else {
                $('.publish_btn').css({'background':'#ccc'});
            }
        });
        $("#name").bind(bind_name, function (event) {
            if($('#phone').val().length == 11 && $('#name').val().length > 0){
                $('.publish_btn').css({'background':'#0f84de'});
            }else{
                $('.publish_btn').css({'background':'#ccc'});
            }
        });



    });
</script>

</body>
</html>