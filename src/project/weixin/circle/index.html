<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>车友圈</title>
    @import "../include/header.inc";

</head>
<body ontouchstart>
<div class="weui-toptips weui-toptips_warn js_tooltips">错误提示</div>
<div class="container" id="container"></div>

<!--首页-->
<link rel="import" href="../../../pages/circle/index.html">


@import "../../../model/widget/include/toast.html";
@import "../../../model/widget/include/dialog.html";
<script src="/weixin/js/wap.min.js"></script>
<script type="text/javascript">
    $(function () {
        pageManager.show("index");

        $('#publish').click(function () {
            window.location.href = '/weixin/circle/send.html';
        });

        var oDiv = document.getElementById('publish');
        var disX, disY, moveX, moveY, L, T, starX, starY, starXEnd, starYEnd;

        // oDiv.addEventListener('touchstart', function (e) {
        //     e.preventDefault();//阻止触摸时页面的滚动，缩放
        //     disX = e.touches[0].clientX - this.offsetLeft;
        //     disY = e.touches[0].clientY - this.offsetTop;
        //     //手指按下时的坐标
        //     starX = e.touches[0].clientX;
        //     starY = e.touches[0].clientY;
        //     //console.log(disX);
        // });
        // oDiv.addEventListener('touchmove', function (e) {
        //     L = e.touches[0].clientX - disX;
        //     T = e.touches[0].clientY - disY;
        //     //移动时 当前位置与起始位置之间的差值
        //     starXEnd = e.touches[0].clientX - starX;
        //     starYEnd = e.touches[0].clientY - starY;
        //     //console.log(L);
        //     if (L < 0) {//限制拖拽的X范围，不能拖出屏幕
        //         L = 0;
        //     }
        //     else if (L > document.documentElement.clientWidth - this.offsetWidth) {
        //         L = document.documentElement.clientWidth - this.offsetWidth;
        //     }
        //
        //     if (T < 0) {//限制拖拽的Y范围，不能拖出屏幕
        //         T = 0;
        //     }
        //     else if (T > document.documentElement.clientHeight - this.offsetHeight) {
        //         T = document.documentElement.clientHeight - this.offsetHeight - 53;
        //     }
        //     moveX = L + 'px';
        //     moveY = T + 'px';
        //     this.style.left = moveX;
        //     this.style.top = moveY;
        // });








        new contact(function (data) {
            console.log(data);
            // $("#index_slider").silderDot(data, 1800, "");
            // var circle = render.fill($("#tpl_list"), data.return_new);
            // $(".circle_list").html(circle);


            for(var i = 0; i<data.return_new.length; i++){
                var str = '';
                str += '<div class="weui-cell_access weui-cell" data-id="' + data.return_new[i].id + '">';
                if(data.return_new[i].headerimg == ''){
                    str += '<div class="weui-cell__hd headImg"><img src="/weixin/images/placeholder/logo.png"/></div>';
                }else {
                    str += '<div class="weui-cell__hd headImg"><img src="' + data.return_new[i].headerimg + '"/></div>';
                }
                str += '<div class="weui-cell__bd">';
                str += '<span class="f12 gray02">爱上耗子的猫</span>';
                str += '<div class="circle_txt f11">' + data.return_new[i].content + '</div>';
                if(data.return_new[i].images != null){
                    str += '<div class="circle_img clearfix">';
                    for(var j = 0;j < data.return_new[i].images.length; j++){
                        str += '<img class="sendimg" src="' + data.return_new[i].images[j].images + '"/>';
                    }
                    str += '</div>';
                }
                str += '<div class="weui-cell bordernone operation">';
                str += '<div class="weui-cell__hd time f10 gray04">' + data.return_new[i].addtime + '</div>';
                str += '<div class="weui-cell__bd tr" id="' + data.return_new[i].id + '">';
                str += '<i class="iconfont icon-pinglun f20 blue01 operation_btn"></i>';
                str += '<div class="operationCont gray07_bg f10 weui-flex none">';
                str += '<span class="weui-flex__item tc"><i class="iconfont icon-heart f16"></i><span>点赞</span></span>';
                str += '<span class="weui-flex__item tc"><i class="iconfont icon-pinglun-copy f16"></i><span>评论</span></span>';
                str += '</div>';
                str += '</div>';
                str += '</div>';
                str += '<div class="operationTxt gray08_bg">';
                str += '<span class="arrow_top"></span>';
                str += '<div class="zan_people">';
                str += '<i class="iconfont icon-heart f12 blue02"></i>';
                str += '<span class="blue02 f12">文文，小李</span>';
                str += '</div>';
                if(data.return_new[i].comment != ''){
                    str += '<div class="comment topLine">';
                    for(var k = 0; k<data.return_new[i].comment.length; k++){
                        str += '<p class="f11 gray02"><span class="blue02">' + data.return_new[i].comment[k].author + '：</span>'+ data.return_new[i].comment[k].comment + '</p>';
                    }
                    str += '</div>';
                }
                str += '</div>';
                str += '</div>';
                str += '</div>';
                $(".circle_list").append(str);
            }








            $(document).on('click','.operation_btn',function () {
                var id = $(this).parent().attr('id');
                console.log(id);
                $('#' + id).find('.operationCont').toggleClass('none');
            });






            var imgsObj = $('.sendimg');
            var imgs = new Array();
            for(var i = 0; i < imgsObj.size(); i++){
                imgs.push(imgsObj.eq(i).attr('src'));
            };

            $(document).on('click','.sendimg',function () {
                WeixinJSBridge.invoke('imagePreview', {
                    'current': $(this).attr('src'),
                    'urls': imgs
                });
            });

        }).list()


    });
</script>

</body>
</html>