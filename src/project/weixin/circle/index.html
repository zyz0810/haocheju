<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>车友圈</title>
    @import "../include/header.inc";

</head>
<body ontouchstart>
<div class="weui-toptips weui-toptips_warn js_tooltips">错误提示</div>
<div class="container" id="container"></div>

<!--首页-->
<link rel="import" href="../../../pages/circle/index.html">

<link rel="import" href="../../../model/templete/circle/list.html"> <!--优惠券列表模板-->
@import "../../../model/widget/include/toast.html";
@import "../../../model/widget/include/dialog.html";
<script src='https://cdn.jsdelivr.net/mojs/0.265.6/mo.min.js'></script>
<script src="/weixin/js/wap.min.js"></script>
<script type="text/javascript">
    $(function () {
        pageManager.show("index");
        var userId = cookie.getCookie('userId');
        // var myname = cookie.getCookie('userName');


        new member(function (data) {
            if(data.nickname == ""){
                var myname = data.username;
            }else{
                var myname = data.nickname;
            }


            //评论
            // $(document).on('click','.pinglun',function () {
            $('.pinglun').die().live('click',function () {
                console.log('00');
                var id = $(this).parent().attr('data-id');
                $('#' + id).addClass('none');
                var $this=$(this);
//              var myname = $(this).attr('data-name');
                var id = $(this).parent().attr('id');
                $(".comment_area" + id).removeClass('none');
                // $('.foot_menu').addClass('none');
                $(".comment_area" + id + " input").focus();
                $(".comment_area" + id + " input").die().live('change',function () {
                    var $sth=$(this);
                    var content= $(".comment_area" + id).find('input').val();
                    new contact(function (data) {
                        $(".comment_area" + id).addClass('none');
                        // $('.foot_menu').removeClass('none');
                        if($('.operationTxt'+id).length == 0){
                            $('.operationTxt'+id).removeClass('none');
                            $this.parent().parent().parent().parent().append('<div class="operationTxt gray08_bg operationTxt' + id + '"><span class="arrow_top"></span><div class="comment topLine comment'+ id +'"><p class="f13 gray02"><span class="blue02">' + myname + '：</span>'+ content + '</p></div></div>')
                            // <div class="operationTxt gray08_bg operationTxt6"><span class="arrow_top"></span><div class="comment topLine comment6"><p class="f13 gray02" data-id="6"><span class="blue02"></span>：1</p></div></div>
                        }else if($('.comment'+id).length == 0){
                            $('.operationTxt'+id).removeClass('none');
                            $this.parent().parent().parent().parent().find('.operationTxt'+id).append('<div class="comment topLine comment'+ id +'"><p class="f13 gray02"><span class="blue02">' + myname + '：</span>'+ content + '</p></div>')
                        }else{
                            $('.operationTxt'+id).removeClass('none');
                            $this.parent().parent().parent().parent().find('.comment').append('<p class="f13 gray02"><span class="blue02">' + myname + '：</span>'+ content + '</p>');
                        }
                        $(this).val('');
                    }).reply({pauthor:'',author:myname,cid:id,comment:content});
                    $(".comment_area" + id).find('input').val('');
                })
            });




            // $(".comment_area input").die().live('change',function () {
            //     console.log(11111111)
            //     var $this=$(this);
            //     var id = $(this).attr('data-id');
            //     var content= $(".comment_area" + id).find('input').val();
            //     new contact(function (data) {
            //         // $(".comment_area" + id).addClass('none');
            //         // $('.foot_menu').removeClass('none');
            //         if($('.operationTxt'+id).length == 0){
            //             $this.parent().parent().parent().find('.cont'+id).append('<div class="operationTxt gray08_bg operationTxt' + id + '"><span class="arrow_top"></span><div class="comment topLine comment'+ id +'"><p class="f13 gray02"><span class="blue02">' + myname + '：</span>'+ content + '</p></div></div>')
            //             // <div class="operationTxt gray08_bg operationTxt6"><span class="arrow_top"></span><div class="comment topLine comment6"><p class="f13 gray02" data-id="6"><span class="blue02"></span>：1</p></div></div>
            //         }else if($('.comment'+id).length == 0){
            //             $this.parent().parent().parent().find('.operationTxt'+id).append('<div class="comment topLine comment'+ id +'"><p class="f13 gray02"><span class="blue02">' + myname + '：</span>'+ content + '</p></div>')
            //         }else{
            //             console.log('评论');
            //             console.log($this.parent().parent().find('.comment'));
            //             $this.parent().parent().parent().find('.comment').append('<p class="f13 gray02"><span class="blue02">' + myname + '：</span>'+ content + '</p>');
            //         }
            //         $(this).val('');
            //     }).reply({pauthor:'',author:myname,cid:id,comment:content});
            //     $(".comment_area" + id).find('input').val('');
            // });





            //回复下方已有的评论
            // $('.comment p').click(function() {
            $(document).on('click','.comment p',function () {
                console.log(222222)
                var id = $(this).attr('data-id');
                $('#' + id).addClass('none');
                var $this=$(this);
                var rewho=$this.find('.blue02').first().html();
                var id=$(this).attr('data-id');
                $(".comment_area" + id).removeClass('none');
                // $('.foot_menu').addClass('none');
                $(".comment_area" + id + " input").focus();
                $(".comment_area" + id + " input").attr('placeholder','回复'+rewho);
                $(".comment_area" + id + " input").die().live('change',function () {
                    var content=$(".comment_area" + id).find('input').val();
                    var $sth=$(this);
                    new contact(function (data) {
                        $(".comment_area" + id).addClass('none');
                        // $('.foot_menu').removeClass('none');
                        console.log($this)
                        $this.after('<p class="f13 gray02"><span class="blue02">' + myname + '</span> 回复 <span class="blue02">' + rewho + '：</span>'+ content + '</p>');
                    }).reply({pauthor:rewho,author:myname,cid:id,comment:content});
                    $(".comment_area" + id).find('input').val('');
                })

            });

        }).view({userId:userId});

        console.log('用户id：'+userId);

        $('#publish').click(function () {
            window.location.href = '/weixin/circle/send.html';
        });

        var oDiv = document.getElementById('publish');
        var disX, disY, moveX, moveY, L, T, starX, starY, starXEnd, starYEnd;

        // oDiv.addEventListener('touchstart', function (e) {
        //     e.preventDefault();//阻止触摸时页面的滚动，缩放
        //     disX = e.touches[0].clientX - this.offsetLeft;
        //     disY = e.touches[0].clientY - this.offsetTop;
        //     //手指按下时的坐标
        //     starX = e.touches[0].clientX;
        //     starY = e.touches[0].clientY;
        //     //console.log(disX);
        // });
        // oDiv.addEventListener('touchmove', function (e) {
        //     L = e.touches[0].clientX - disX;
        //     T = e.touches[0].clientY - disY;
        //     //移动时 当前位置与起始位置之间的差值
        //     starXEnd = e.touches[0].clientX - starX;
        //     starYEnd = e.touches[0].clientY - starY;
        //     //console.log(L);
        //     if (L < 0) {//限制拖拽的X范围，不能拖出屏幕
        //         L = 0;
        //     }
        //     else if (L > document.documentElement.clientWidth - this.offsetWidth) {
        //         L = document.documentElement.clientWidth - this.offsetWidth;
        //     }
        //
        //     if (T < 0) {//限制拖拽的Y范围，不能拖出屏幕
        //         T = 0;
        //     }
        //     else if (T > document.documentElement.clientHeight - this.offsetHeight) {
        //         T = document.documentElement.clientHeight - this.offsetHeight - 53;
        //     }
        //     moveX = L + 'px';
        //     moveY = T + 'px';
        //     this.style.left = moveX;
        //     this.style.top = moveY;
        // });

        //防止键盘把当前输入框给挡住
        // $('input[type="text"],textarea').on('click', function () {
        //     var target = this;
        //     setTimeout(function(){
        //         target.scrollIntoViewIfNeeded();
        //         console.log('scrollIntoViewIfNeeded');
        //     },400);
        // });


        var timer = null;
        $('input').on('focus', function() {
            clearInterval(timer);
            var index = 0;
            timer = setInterval(function() {
                if(index>5) {
                    $('body').scrollTop(1000000);
                    clearInterval(timer);
                }
                index++;
            }, 50)
        });

        var aa = new contact(function (data) {
            $("#index_slider").silderDot(data, 1800, "");
        });
        aa.list();

        var pge = $(".pageable").pageable({
            scrollFn:function () {
                $(window).trigger('scroll');
            },
            loadUpFn: function (me) {
                new contact(function (data) {
                    $(".circle_list").html('');
                    console.log(data);
                    for(var i = 0; i<data.return_new.data.length; i++){
                        var str = '';
                        str += '<div class="weui-cells bordernone list_item" data-id="' + data.return_new.data[i].id + '">';
                        str += '<div class="circle_item weui-cell" data-id="' + data.return_new.data[i].id + '">';
                        if(data.return_new.data[i].headerimg == null){
                            str += '<div class="weui-cell__hd headImg"><img src="/weixin/images/placeholder/logo.png"/></div>';
                        }else {
                            str += '<div class="weui-cell__hd headImg"><img src="' + data.return_new.data[i].headerimg + '"/></div>';
                        }
                        str += '<div class="weui-cell__bd cont' + data.return_new.data[i].id + '">';
                        str += '<span class="f13 gray02">' + data.return_new.data[i].username + '</span>';
                        str += '<div class="circle_txt f13">' + data.return_new.data[i].content + '</div>';
                        if(data.return_new.data[i].images != null){
                            str += '<div class="circle_img clearfix">';
                            for(var j = 0;j < data.return_new.data[i].images.length; j++){
                                str += '<img class="sendimg" src="' + data.return_new.data[i].images[j] + '"/>';
                            }
                            str += '</div>';
                        }
                        str += '<div class="weui-cell bordernone operation">';
                        str += '<div class="weui-cell__hd time f10 gray04">' + data.return_new.data[i].addtime + '</div>';
                        str += '<div class="weui-cell__bd tr" style="align-items: flex-end;" data-id="' + data.return_new.data[i].id + '">';
                        str += '<i class="iconfont icon-pinglun f20 blue01 operation_btn" style="display: block;width: 30px;cursor: pointer;"></i>';
                        str += '<div class="operationCont gray07_bg f10 weui-flex none" data-id="' + data.return_new.data[i].id + '" id="' + data.return_new.data[i].id + '">';
                        str += '<span class="weui-flex__item tc dianzan"><i class="iconfont icon-heart f16"></i>';
                        if(data.return_new.data[i].isspot == '0'){
                            str += '<span class="dianzan_txt">点赞</span>';
                            str += '<span class="quxiao_txt none">取消</span>';
                        }else{
                            str += '<span class="dianzan_txt none">点赞</span>';
                            str += '<span class="quxiao_txt">取消</span>';
                        }
                        str += '</span>';
                        str += '<span class="weui-flex__item tc pinglun"><i class="iconfont icon-pinglun-copy f16"></i><span>评论</span></span>';
                        str += '</div>';
                        str += '</div>';
                        str += '</div>';

                        if(data.return_new.data[i].spotlist != '' || data.return_new.data[i].comment != ''){
                            str += '<div class="operationTxt gray08_bg operationTxt' +  data.return_new.data[i].id + '">';
                            str += '<span class="arrow_top"></span>';

                            if(data.return_new.data[i].spotlist != ''){
                                str += '<div class="zan_people">';
                                str += '<i class="iconfont icon-heart f13 blue02"></i>';
                                str += '<div class="blue02 f13">';
                                for(var l = 0; l < data.return_new.data[i].spotlist.length;l++){
                                    if(l==data.return_new.data[i].spotlist.length - 1){
                                        str += '<div data-id="' + data.return_new.data[i].spotlist[l].id + '"><span>' + data.return_new.data[i].spotlist[l].nickname + '<span></div>';
                                    }else{
                                        str += '<div data-id="' + data.return_new.data[i].spotlist[l].id + '"><span>' + data.return_new.data[i].spotlist[l].nickname + '<span>，</div>';
                                    }
                                }
                                str += '</div>';
                                str += '</div>';
                            }else{
                                str += '<div class="zan_people none">';
                                str += '<i class="iconfont icon-heart f13 blue02"></i>';
                                str += '<div class="blue02 f13">';
                                for(var l = 0; l < data.return_new.data[i].spotlist.length;l++){
                                    if(l==data.return_new.data[i].spotlist.length - 1){
                                        str += '<div data-id="' + data.return_new.data[i].spotlist[l].id + '"><span>' + data.return_new.data[i].spotlist[l].nickname + '<span></div>';
                                    }else{
                                        str += '<div data-id="' + data.return_new.data[i].spotlist[l].id + '"><span>' + data.return_new.data[i].spotlist[l].nickname + '<span>，</div>';
                                    }
                                }
                                str += '</div>';
                                str += '</div>';
                            }

                            if(data.return_new.data[i].comment != ''){
                                if(data.return_new.data[i].comment.length > 6){
                                    str += '<div class="comment more_height topLine comment' + data.return_new.data[i].id + '">';
                                }else{
                                    str += '<div class="comment topLine comment' + data.return_new.data[i].id + '">';
                                }
                                for(var k = 0; k<data.return_new.data[i].comment.length; k++){
                                    if(data.return_new.data[i].comment[k].pname == ''){
                                        str += '<p class="f13 gray02" data-id="' + data.return_new.data[i].id + '"><span class="blue02">' + data.return_new.data[i].comment[k].author + '</span>：'+ data.return_new.data[i].comment[k].comment + '</p>';
                                    }else{
                                        str += '<p class="f13 gray02" data-id="' + data.return_new.data[i].id + '"><span class="blue02">' + data.return_new.data[i].comment[k].pname + '</span> 回复 <span class="blue02">' + data.return_new.data[i].comment[k].author + '</span>：'+ data.return_new.data[i].comment[k].comment + '</p>';
                                    }
                                }
                                if(data.return_new.data[i].comment.length > 6){
                                    str += '<div class="more_comment f12 tc gray02 gray08_bg blue02">更多</div>';
                                }
                                str += '</div>';
                            }else{
                                if(data.return_new.data[i].comment.length > 6){
                                    str += '<div class="comment more_height topLine comment' + data.return_new.data[i].id + '">';
                                }else{
                                    str += '<div class="comment topLine comment' + data.return_new.data[i].id + '">';
                                }
                                for(var k = 0; k<data.return_new.data[i].comment.length; k++){
                                    if(data.return_new.data[i].comment[k].pname == ''){
                                        str += '<p class="f13 gray02" data-id="' + data.return_new.data[i].id + '"><span class="blue02">' + data.return_new.data[i].comment[k].author + '</span>：'+ data.return_new.data[i].comment[k].comment + '</p>';
                                    }else{
                                        str += '<p class="f13 gray02" data-id="' + data.return_new.data[i].id + '"><span class="blue02">' + data.return_new.data[i].comment[k].pname + '</span> 回复 <span class="blue02">' + data.return_new.data[i].comment[k].author + '</span>：'+ data.return_new.data[i].comment[k].comment + '</p>';
                                    }
                                }
                                if(data.return_new.data[i].comment.length > 6){
                                    str += '<div class="more_comment f12 tc gray02 gray08_bg blue02">更多</div>';
                                }
                                str += '</div>';
                            }
                            str += '</div>';
                        }else if(data.return_new.data[i].spotlist == '' && data.return_new.data[i].comment == ''){
                            str += '<div class="operationTxt gray08_bg none operationTxt' +  data.return_new.data[i].id + '">';
                            str += '<span class="arrow_top"></span>';

                            if(data.return_new.data[i].spotlist == ''){
                                str += '<div class="zan_people none">';
                                str += '<i class="iconfont icon-heart f13 blue02"></i>';
                                str += '<div class="blue02 f13">';
                                for(var l = 0; l < data.return_new.data[i].spotlist.length;l++){
                                    if(l==data.return_new.data[i].spotlist.length - 1){
                                        str += '<div data-id="' + data.return_new.data[i].spotlist[l].id + '"><span>' + data.return_new.data[i].spotlist[l].nickname + '<span></div>';
                                    }else{
                                        str += '<div data-id="' + data.return_new.data[i].spotlist[l].id + '"><span>' + data.return_new.data[i].spotlist[l].nickname + '<span>，</div>';
                                    }
                                }
                                str += '</div>';
                                str += '</div>';
                            }

                            if(data.return_new.data[i].comment == ''){
                                if(data.return_new.data[i].comment.length > 6){
                                    str += '<div class="comment more_height more_list none topLine comment' + data.return_new.data[i].id + '">';
                                }else{
                                    str += '<div class="comment none topLine comment' + data.return_new.data[i].id + '">';
                                }
                                for(var k = 0; k<data.return_new.data[i].comment.length; k++){
                                    if(data.return_new.data[i].comment[k].pname == ''){
                                        str += '<p class="f13 gray02" data-id="' + data.return_new.data[i].id + '"><span class="blue02">' + data.return_new.data[i].comment[k].author + '</span>：'+ data.return_new.data[i].comment[k].comment + '</p>';
                                    }else{
                                        str += '<p class="f13 gray02" data-id="' + data.return_new.data[i].id + '"><span class="blue02">' + data.return_new.data[i].comment[k].pname + '</span> 回复 <span class="blue02">' + data.return_new.data[i].comment[k].author + '</span>：'+ data.return_new.data[i].comment[k].comment + '</p>';
                                    }
                                }
                                if(data.return_new.data[i].comment.length > 6){
                                    str += '<div class="more_comment f12 tc gray02 gray08_bg blue02">更多</div>';
                                }
                                str += '</div>';
                            }
                            str += '</div>';
                        }
                        str += '</div>';

                        // str += '<div class="weui-cell comment_area none comment_area' + data.return_new.data[i].id + '"><div class="weui-cell__bd"><input type="text" placeholder="评论" class="comment_txt" data-id="' + data.return_new.data[i].id + '" /></div><div class="weui-cell__ft" style="cursor: pointer;">发送</div></div>';
                        str += '</div>';
                        str += '<div class="weui-cell bordernone comment_area none comment_area' + data.return_new.data[i].id + '" data-id="' + data.return_new.data[i].id + '><div class="weui-cell__bd"><input type="text" placeholder="评论" class="comment_txt" data-id="' + data.return_new.data[i].id + '" /></div></div>';
                        str += '</div>';
                        $(".circle_list").append(str);
                    }

                    $('img').picLazyLoad();
                    pge.resetload();

                }).list({page: 1,pageSize:10,userId:userId,type:1})
            },
            loadDownFn: function (me) {
                new contact(function (data) {
                    console.log(data);
                    me.pageNumber = me.pageNumber +1;
                    // var circle = render.fill($("#tpl_list"), data.return_new.data);
                    // $(".circle_list").html(circle);
                    for(var i = 0; i<data.return_new.data.length; i++){
                        var str = '';
                        str += '<div class="weui-cells bordernone list_item" data-id="' + data.return_new.data[i].id + '">';
                        str += '<div class="circle_item weui-cell" data-id="' + data.return_new.data[i].id + '">';
                        if(data.return_new.data[i].headerimg == null){
                            str += '<div class="weui-cell__hd headImg"><img src="/weixin/images/placeholder/logo.png"/></div>';
                        }else {
                            str += '<div class="weui-cell__hd headImg"><img src="' + data.return_new.data[i].headerimg + '"/></div>';
                        }
                        str += '<div class="weui-cell__bd cont' + data.return_new.data[i].id + '">';
                        str += '<span class="f13 gray02">' + data.return_new.data[i].username + '</span>';
                        str += '<div class="circle_txt f13">' + data.return_new.data[i].content + '</div>';
                        if(data.return_new.data[i].images != null){
                            str += '<div class="circle_img clearfix">';
                            for(var j = 0;j < data.return_new.data[i].images.length; j++){
                                str += '<img class="sendimg" src="' + data.return_new.data[i].images[j] + '"/>';
                            }
                            str += '</div>';
                        }
                        str += '<div class="weui-cell bordernone operation">';
                        str += '<div class="weui-cell__hd time f10 gray04">' + data.return_new.data[i].addtime + '</div>';
                        str += '<div class="weui-cell__bd tr" style="align-items: flex-end;" data-id="' + data.return_new.data[i].id + '">';
                        str += '<i class="iconfont icon-pinglun f20 blue01 operation_btn" style="display: block;width: 30px;cursor: pointer;"></i>';
                        str += '<div class="operationCont gray07_bg f10 weui-flex none" data-id="' + data.return_new.data[i].id + '" id="' + data.return_new.data[i].id + '">';
                        str += '<span class="weui-flex__item tc dianzan"><i class="iconfont icon-heart f16"></i>';
                        if(data.return_new.data[i].isspot == '0'){
                            str += '<span class="dianzan_txt">点赞</span>';
                            str += '<span class="quxiao_txt none">取消</span>';
                        }else{
                            str += '<span class="dianzan_txt none">点赞</span>';
                            str += '<span class="quxiao_txt">取消</span>';
                        }
                        str += '</span>';
                        str += '<span class="weui-flex__item tc pinglun"><i class="iconfont icon-pinglun-copy f16"></i><span>评论</span></span>';
                        str += '</div>';
                        str += '</div>';
                        str += '</div>';

                        if(data.return_new.data[i].spotlist != '' || data.return_new.data[i].comment != ''){
                            str += '<div class="operationTxt gray08_bg operationTxt' +  data.return_new.data[i].id + '">';
                            str += '<span class="arrow_top"></span>';

                            if(data.return_new.data[i].spotlist != ''){
                                str += '<div class="zan_people">';
                                str += '<i class="iconfont icon-heart f13 blue02"></i>';
                                str += '<div class="blue02 f13">';
                                for(var l = 0; l < data.return_new.data[i].spotlist.length;l++){
                                    if(l==data.return_new.data[i].spotlist.length - 1){
                                        str += '<div data-id="' + data.return_new.data[i].spotlist[l].id + '"><span>' + data.return_new.data[i].spotlist[l].nickname + '<span></div>';
                                    }else{
                                        str += '<div data-id="' + data.return_new.data[i].spotlist[l].id + '"><span>' + data.return_new.data[i].spotlist[l].nickname + '<span>，</div>';
                                    }
                                }
                                str += '</div>';
                                str += '</div>';
                            }else{
                                str += '<div class="zan_people none">';
                                str += '<i class="iconfont icon-heart f13 blue02"></i>';
                                str += '<div class="blue02 f13">';
                                for(var l = 0; l < data.return_new.data[i].spotlist.length;l++){
                                    if(l==data.return_new.data[i].spotlist.length - 1){
                                        str += '<div data-id="' + data.return_new.data[i].spotlist[l].id + '"><span>' + data.return_new.data[i].spotlist[l].nickname + '<span></div>';
                                    }else{
                                        str += '<div data-id="' + data.return_new.data[i].spotlist[l].id + '"><span>' + data.return_new.data[i].spotlist[l].nickname + '<span>，</div>';
                                    }
                                }
                                str += '</div>';
                                str += '</div>';
                            }

                            if(data.return_new.data[i].comment != ''){
                                if(data.return_new.data[i].comment.length > 6){
                                    str += '<div class="comment more_height topLine comment' + data.return_new.data[i].id + '">';
                                }else{
                                    str += '<div class="comment topLine comment' + data.return_new.data[i].id + '">';
                                }
                                for(var k = 0; k<data.return_new.data[i].comment.length; k++){
                                    if(data.return_new.data[i].comment[k].pname == ''){
                                        str += '<p class="f13 gray02" data-id="' + data.return_new.data[i].id + '"><span class="blue02">' + data.return_new.data[i].comment[k].author + '</span>：'+ data.return_new.data[i].comment[k].comment + '</p>';
                                    }else{
                                        str += '<p class="f13 gray02" data-id="' + data.return_new.data[i].id + '"><span class="blue02">' + data.return_new.data[i].comment[k].pname + '</span> 回复 <span class="blue02">' + data.return_new.data[i].comment[k].author + '</span>：'+ data.return_new.data[i].comment[k].comment + '</p>';
                                    }
                                }
                                if(data.return_new.data[i].comment.length > 6){
                                    str += '<div class="more_comment f12 tc gray02 gray08_bg blue02">更多</div>';
                                }
                                str += '</div>';
                            }else{
                                if(data.return_new.data[i].comment.length > 6){
                                    str += '<div class="comment more_height topLine comment' + data.return_new.data[i].id + '">';
                                }else{
                                    str += '<div class="comment topLine comment' + data.return_new.data[i].id + '">';
                                }
                                for(var k = 0; k<data.return_new.data[i].comment.length; k++){
                                    if(data.return_new.data[i].comment[k].pname == ''){
                                        str += '<p class="f13 gray02" data-id="' + data.return_new.data[i].id + '"><span class="blue02">' + data.return_new.data[i].comment[k].author + '</span>：'+ data.return_new.data[i].comment[k].comment + '</p>';
                                    }else{
                                        str += '<p class="f13 gray02" data-id="' + data.return_new.data[i].id + '"><span class="blue02">' + data.return_new.data[i].comment[k].pname + '</span> 回复 <span class="blue02">' + data.return_new.data[i].comment[k].author + '</span>：'+ data.return_new.data[i].comment[k].comment + '</p>';
                                    }
                                }
                                if(data.return_new.data[i].comment.length > 6){
                                    str += '<div class="more_comment f12 tc gray02 gray08_bg blue02">更多</div>';
                                }
                                str += '</div>';
                            }
                            str += '</div>';
                        }else if(data.return_new.data[i].spotlist == '' && data.return_new.data[i].comment == ''){
                            str += '<div class="operationTxt gray08_bg none operationTxt' +  data.return_new.data[i].id + '">';
                            str += '<span class="arrow_top"></span>';

                            if(data.return_new.data[i].spotlist == ''){
                                str += '<div class="zan_people none">';
                                str += '<i class="iconfont icon-heart f13 blue02"></i>';
                                str += '<div class="blue02 f13">';
                                for(var l = 0; l < data.return_new.data[i].spotlist.length;l++){
                                    if(l==data.return_new.data[i].spotlist.length - 1){
                                        str += '<div data-id="' + data.return_new.data[i].spotlist[l].id + '"><span>' + data.return_new.data[i].spotlist[l].nickname + '<span></div>';
                                    }else{
                                        str += '<div data-id="' + data.return_new.data[i].spotlist[l].id + '"><span>' + data.return_new.data[i].spotlist[l].nickname + '<span>，</div>';
                                    }
                                }
                                str += '</div>';
                                str += '</div>';
                            }

                            if(data.return_new.data[i].comment == ''){
                                if(data.return_new.data[i].comment.length > 6){
                                    str += '<div class="comment more_height more_list none topLine comment' + data.return_new.data[i].id + '">';
                                }else{
                                    str += '<div class="comment none topLine comment' + data.return_new.data[i].id + '">';
                                }
                                for(var k = 0; k<data.return_new.data[i].comment.length; k++){
                                    if(data.return_new.data[i].comment[k].pname == ''){
                                        str += '<p class="f13 gray02" data-id="' + data.return_new.data[i].id + '"><span class="blue02">' + data.return_new.data[i].comment[k].author + '</span>：'+ data.return_new.data[i].comment[k].comment + '</p>';
                                    }else{
                                        str += '<p class="f13 gray02" data-id="' + data.return_new.data[i].id + '"><span class="blue02">' + data.return_new.data[i].comment[k].pname + '</span> 回复 <span class="blue02">' + data.return_new.data[i].comment[k].author + '</span>：'+ data.return_new.data[i].comment[k].comment + '</p>';
                                    }
                                }
                                if(data.return_new.data[i].comment.length > 6){
                                    str += '<div class="more_comment f12 tc gray02 gray08_bg blue02">更多</div>';
                                }
                                str += '</div>';
                            }
                            str += '</div>';
                        }
                        str += '</div>';
                        
                        // str += '<div class="weui-cell comment_area none comment_area' + data.return_new.data[i].id + '"><div class="weui-cell__bd"><input type="text" placeholder="评论" class="comment_txt" data-id="' + data.return_new.data[i].id + '" /></div><div class="weui-cell__ft" style="cursor: pointer;">发送</div></div>';
                        str += '</div>';
                        str += '<div class="weui-cell bordernone comment_area none comment_area' + data.return_new.data[i].id + '" data-id="' + data.return_new.data[i].id + '><div class="weui-cell__bd"><input type="text" placeholder="评论" class="comment_txt" data-id="' + data.return_new.data[i].id + '" /></div></div>';
                        str += '</div>';
                        $(".circle_list").append(str);
                    }

                    $('img').picLazyLoad();
                    if (data.return_new.data.length < 10) {
                        pge.lock();
                        pge.noData();
                    }
                    pge.resetload();

                }).list({page: me.pageNumber,pageSize:10,userId:userId,type:1});
            }
        });


        $(document).on('click','.operation_btn',function () {
            var id = $(this).parent().attr('data-id');
            console.log(id);
            $('#' + id).toggleClass('none');
        });




        //预览大图
        $(document).on('click','.sendimg',function () {
            var imgsObj = $('.sendimg');
            var imgs = new Array();
            for(var i = 0; i < imgsObj.size(); i++){
                imgs.push(imgsObj.eq(i).attr('src'));
            }
            WeixinJSBridge.invoke('imagePreview', {
                'current': $(this).attr('src'),
                'urls': imgs
            });
        });


        var timer = null;
        $('input').on('focus', function() {
            clearInterval(timer);
            var index = 0;
            timer = setInterval(function() {
                if(index>5) {
                    $('body').scrollTop(1000000);
                    clearInterval(timer);
                }
                index++;
            }, 50)
        });
        //点赞
        $(document).on('click','.dianzan',function () {
            init();
            var $this = $(this);
            var id = $(this).parent().attr('id');
            console.log(id);
            new contact(function (data) {
                $('#' + id).addClass('none');
                console.log('点赞：'+data.isspot);
                console.log(data);

                if(data.isspot == '0'){
                    console.log('取消点赞');
                    $('#' + id).find('.dianzan_txt').removeClass('none');
                    $('#' + id).find('.quxiao_txt').addClass('none');
                    if(data.spotlist.length>0){
//                        if($('.cont' + id + '>div').hasClass('operationTxt')){
                            var zanList = '';
                            // zanList += '<div class="zan_people">';
                            zanList += '<i class="iconfont icon-heart f13 blue02"></i>';
                            zanList += '<div class="blue02 f13">';
                            for(var m = 0; m < data.spotlist.length;m++){
                                if(m == data.spotlist.length - 1){
                                    zanList += '<div data-id="' + data.spotlist[m].id + '"><span>' + data.spotlist[m].nickname + '<span></div>';
                                }else{
                                    zanList += '<div data-id="' + data.spotlist[m].id + '"><span>' + data.spotlist[m].nickname + '<span>，</div>';
                                }
                            }
                            zanList += '</div>';
                            // zanList += '</div>';
                            $('.cont' + id).find('.operationTxt .zan_people').html(zanList);

//                        }else{
//                            var zanList = '';
//                            zanList += '<div class="operationTxt gray08_bg"><span class="arrow_top"></span>';
//                            zanList += '<div class="zan_people">';
//                            zanList += '<i class="iconfont icon-heart f13 blue02"></i>';
//                            zanList += '<div class="blue02 f13">';
//                            for(var m = 0; m < data.spotlist.length;m++){
//                                if(m==data.spotlist.length - 1){
//                                    zanList += '<div data-id="' + data.spotlist[m].id + '"><span>' + data.spotlist[m].nickname + '<span></div>';
//                                }else{
//                                    zanList += '<div data-id="' + data.spotlist[m].id + '"><span>' + data.spotlist[m].nickname + '<span>，</div>';
//                                }
//
//                            }
//                            zanList += '</div>';
//                            zanList += '</div>';
//                            zanList += '</div>';
//                            $('.cont'+id).append(zanList);
//                        }
                    }else{
//                        if($('.cont' + id).find('.operationTxt').children().hasClass('comment')){
//                            // $('.comment'+id).parent().find('.zan_people').remove();
//                        }else{
//                            $('.cont' + id).find('.operationTxt').remove();
//                        }
                        $('.cont' + id).find('.operationTxt .zan_people').addClass('none');
                    }
                }else{
                    $('#' + id).find('.dianzan_txt').addClass('none');
                    $('#' + id).find('.quxiao_txt').removeClass('none');
                    if(data.spotlist.length>0){
                        if($('.cont' + id + '>div').hasClass('operationTxt')){
                            var zanList = '';
                            // zanList += '<div class="zan_people">';
                            zanList += '<i class="iconfont icon-heart f13 blue02"></i>';
                            zanList += '<div class="blue02 f13">';
                            for(var m = 0; m < data.spotlist.length;m++){
                                if(m == data.spotlist.length - 1){
                                    zanList += '<div data-id="' + data.spotlist[m].id + '"><span>' + data.spotlist[m].nickname + '<span></div>';
                                }else{
                                    zanList += '<div data-id="' + data.spotlist[m].id + '"><span>' + data.spotlist[m].nickname + '<span>，</div>';
                                }
                            }
                            zanList += '</div>';
                            // zanList += '</div>';
                            $('.cont' + id).find('.operationTxt .zan_people').removeClass('none');
                            $('.cont' + id).find('.operationTxt .zan_people').html(zanList);
                        }else{
                            // var zanList = '';
                            // zanList += '<div class="operationTxt gray08_bg"><span class="arrow_top"></span>';
                            // zanList += '<div class="zan_people">';
                            // zanList += '<i class="iconfont icon-heart f13 blue02"></i>';
                            // zanList += '<div class="blue02 f13">';
                            // for(var m = 0; m < data.spotlist.length;m++){
                            //     if(m==data.spotlist.length - 1){
                            //         zanList += '<div data-id="' + data.spotlist[m].id + '"><span>' + data.spotlist[m].nickname + '<span></div>';
                            //     }else{
                            //         zanList += '<div data-id="' + data.spotlist[m].id + '"><span>' + data.spotlist[m].nickname + '<span>，</div>';
                            //     }
                            // }
                            // zanList += '</div>';
                            // zanList += '</div>';
                            // zanList += '</div>';
                            // $('.cont'+id).append(zanList);

                            $('.cont'+id).find('.operationTxt .zan_people').html('');

                        }
                    }else{
                        if($('.cont' + id).find('.operationTxt').children().hasClass('comment')){
                            $('.comment'+id).parent().find('.zan_people').remove();
                        }else{
                            $('.cont' + id).find('.operationTxt').remove();
                        }
                    }
                }
            }).liked({pid:id,userId:userId})
        });

        //更多评论
        $(document).on('click','.more_comment',function () {

            if($(this).parent().hasClass('more_height')){
                $(this).parent().removeClass('more_height');
                $(this).html('收起')
            }else{
                $(this).parent().addClass('more_height');
                $(this).html('查看更多')
            }
        });




        // taken from mo.js demos
        function isIOSSafari() {
            var userAgent;
            userAgent = window.navigator.userAgent;
            return userAgent.match(/iPad/i) || userAgent.match(/iPhone/i);
        };

        // taken from mo.js demos
        function isTouch() {
            var isIETouch;
            isIETouch = navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0;
            return [].indexOf.call(window, 'ontouchstart') >= 0 || isIETouch;
        };

        // taken from mo.js demos
        var isIOS = isIOSSafari(),
            clickHandler = isIOS || isTouch() ? 'touchstart' : 'click';

        function extend( a, b ) {
            for( var key in b ) {
                if( b.hasOwnProperty( key ) ) {
                    a[key] = b[key];
                }
            }
            return a;
        }

        function Animocon(el, options) {
            this.el = el;
            this.options = extend( {}, this.options );
            extend( this.options, options );

            this.checked = false;

            this.timeline = new mojs.Timeline();

            for(var i = 0, len = this.options.tweens.length; i < len; ++i) {
                this.timeline.add(this.options.tweens[i]);
            }

            var self = this;
            this.el.addEventListener(clickHandler, function() {
                if( self.checked ) {
                    self.options.onUnCheck();
                }
                else {
                    self.options.onCheck();
                    self.timeline.start();
                }
                self.checked = !self.checked;
            });
        }

        Animocon.prototype.options = {
            tweens : [
                new mojs.Burst({
                    shape : 'circle',
                    isRunLess: true
                })
            ],
            onCheck : function() { return false; },
            onUnCheck : function() { return false; }
        };


        function init() {
            /* Icon 1 */
            var el1 = document.querySelector('.dianzan'), el1span = document.querySelector('.dianzan i');
            new Animocon(el1, {
                tweens : [
                    // burst animation
                    new mojs.Burst({
                        parent: el1,
                        duration: 1700,
                        shape : 'circle',
                        fill: '#C0C1C3',
                        x: '-10%',
                        y: '0%',
                        opacity: 0.6,
                        childOptions: { radius: {15:0} },
                        radius: {30:90},
                        count: 6,
                        isRunLess: true,
                        easing: mojs.easing.bezier(0.1, 1, 0.3, 1)
                    }),
                    // ring animation
                    new mojs.Transit({
                        parent: el1,
                        duration: 700,
                        type: 'circle',
                        radius: {0: 60},
                        fill: 'transparent',
                        stroke: '#C0C1C3',
                        strokeWidth: {20:0},
                        opacity: 0.6,
                        x: '-10%',
                        y: '0%',
                        isRunLess: true,
                        easing: mojs.easing.sin.out
                    }),
                    // icon scale animation
                    new mojs.Tween({
                        duration : 1200,
                        onUpdate: function(progress) {
                            if(progress > 0.3) {
                                var elasticOutProgress = mojs.easing.elastic.out(1.43*progress-0.43);
                                el1span.style.WebkitTransform = el1span.style.transform = 'scale3d(' + elasticOutProgress + ',' + elasticOutProgress + ',1)';
                            }
                            else {
                                el1span.style.WebkitTransform = el1span.style.transform = 'scale3d(0,0,1)';
                            }
                        }
                    })
                ],
                onCheck : function() {
                    el1.style.color = '#fff';
                },
                onUnCheck : function() {
                    el1.style.color = '#C0C1C3';
                }
            });
            /* Icon 1 */
        }

        // init();



    });
</script>

</body>
</html>